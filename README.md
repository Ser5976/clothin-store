# Createx

Учебный проект интернет магазина одежды на JavaScrit

(можно посмотреть здесь: https://clothin-store.vercel.app )

## Краткое описание

Полнофункциональное приложение для интернет-магазина одежды с возможностью просмотра товаров (поиск, фильтрация, сортировка), добавления товаров в избранное и корзину (в том числе без авторизации), оформления и оплаты заказов. Пользователи могут оставлять отзывы к товарам и магазину, ставить оценки товарам, влияющие на их рейтинг, а также лайкать или дизлайкать отзывы других пользователей.
Реализованы: авторизация (включая вход через Google), адаптивный интерфейс с поддержкой мобильных и десктопных устройств, личный кабинет и панель администратора для управления товарами и заказами.

## Требования для установки проекта

1.  Установленный Node.js 20.9.0
2.  Установленная локально база данных MySQL
3.  ​Интегрировать UploadThing (библиотека для загрузки файлов)
    - зарегистрироваться на их сайте
    - получить API-ключи
    - создать переменные среды в .env:
      - UPLOADTHING_SECRET
      - UPLOADTHING_APP_ID
4.  Интегрировать ЮKassa( платёжный сервис от Яндекс)
    - зарегистрироваться на их сайте
    - получить API-ключи
    - создать переменные среды в .env:
      - SHOP_ID
      - SECRET_KEY
5.  Наличие Google-аккаунта, для создания проекта в Google Cloud Console
    - создать переменные среды в .env:
    - GOOGLE_CLIENT_ID
    - GOOGLE_SECRET

## Установка проекта

1.  Клонируйте проект на свой компьютер
    - git clone https://github.com/Ser5976/clothin-store.git (с ветки main, она не дефолтная)
2.  Установка зависимостей
    - откройте папку проекта clothing-store в терминале и наберите команду npm install
3.  Добавление переменных окружения в .env

    - NEXT_PUBLIC_DOMAIN=http://localhost:3000
    - NEXT_ORDER=http://localhost:3000

    ### Prisma

    - DATABASE_URL="mysql://root:pasword@localhost:3306/clothing-store"

    ### Auth Providers

    - NEXTAUTH_SECRET(генерируешь произвольный пароль)
    - NEXTAUTH_URL='http://localhost:3000'
    - GOOGLE_CLIENT_ID
    - GOOGLE_SECRET

    ### Uploadthing

    - UPLOADTHING_SECRET
    - UPLOADTHING_APP_ID

    ### Yookassa

    - SHOP_ID
    - SECRET_KEY

4.  Подключение Prisma:
    - npx prisma generate
    - npx prisma migrate dev
5.  Запуск проекта
    - npm run dev(разработка)
    - npm run build, npm run start(продакшен)

## Основной стек технологий

    1. Next.js 14(App Router) — фреймворк для React с поддержкой SSR и маршрутизации, используется  как для frontend, так и для   backend-части проекта( API Routes-реализованы в папке app/api и используются для обработки запросов (получение, создание, обновление,удаление данных)
    2. TypeScript— статическая типизация
    3. Prisma — ORM для работы с базой данных
    4. MySQL — (локальная база данных) — основное хранилище данных
    5. Zustand — локальное хранилище состояния для клиентских данных (корзина, избранное и др.)
    6. NEXTAUTH — полноценная система аутентификации со встроенными провайдерами
    7. TanStack Query — работа с API и кэшированием
    8. React Hook Form + Zod — формы и валидация
    9. Tailwind CSS — утилитарный CSS-фреймворк
    10. UploadThing — загрузка изображений
    11. Shadcn/ui — UI-компоненты
    12. Yookassa API — интеграция онлайн-оплаты
    13. Tiptap — визуальный редактор для описаний
    14. React-toastify —  библиотека уведомлений

## Получение данных

В проекте используются два основных подхода для работы с данными:

      1.Получение редко обновляемых данных
         Для таких данных используется встроенный метод fetch() из Next.js в серверных функциях, с возможностью настройки revalidate, чтобы избежать частых перезапросов
      2.Часто обновляемые данные — TanStack Query + Axios
         Для интерактивных и часто изменяемых данных используется библиотека TanStack Query (react-query) в связке с Axios

## Изменение и удаление данных

Для мутаций данных используются два подхода:

      1. TanStack Query Mutation
      2. Серверные экшены (Server Actions), которые работают напрямую с базой данных ( через Prisma) и не используют HTTP-запросы

## Обработка ошибок

В проекте предусмотрена обработка ошибок. В зависимости от способа работы с данными, применяются разные подходы:

      1. Когда используется fetch() на серверной стороне,  ошибки обрабатываются вручную через  проверку res.ok
         Если res.ok === false, реализуются два подхода:
          - возврат null или undefined - в таком случае ошибка обрабатывается прямо в компоненте
          - throw new Error() - если выбрасывается ошибка, срабатывает файл error.tsx ( который находится в этой папке ), и отображается глобальный fallback UI для ошибок страницы. Этот подход позволяет централизованно обрабатывать ошибки на уровне страницы
      2. Когда используется TanStack Query. TanStack Query автоматически предоставляет состояние  ошибки. Это состояние легко  обрабатывается через переменную isError
      3. Когда используются Server Actions - ошибки в серверных экшенах обрабатываются в компонентах через .then() / .catch():
          - если всё прошло успешно — показывается уведомление с помощью toast
          - если произошла ошибка — в .catch() также выводится уведомление об ошибке через toast

## Обработка состояния загрузки

В проекте предусмотрена обработка состояния загрузки. В зависимости от способа работы с данными, применяются разные подходы:

      1. Когда используется fetch() на серверной стороне, для обработки состояния загрузки используется компонент Suspense с кастомным fallback. Это позволяет отрисовывать, например, спиннер или скелетон во время ожидания данных
      2. Когда используется TanStack Query. TanStack Query автоматически предоставляет состояние  загрузки. Это состояния легко  обрабатываются через переменную  isLoading
      3. Когда используются Server Actions -  состояние загрузки контролируется вручную через useState

## Безопасность данных

- Взаимодействие с базой данных строго типизировано благодаря Prisma, что исключает множество ошибок на этапе разработки
- Все данные, приходящие от клиента, проходят валидацию через Zod-схемы до момента отправки в базу
- Аутентификация и авторизация обрабатываются через NextAuth с поддержкой кастомного входа и OAuth (Google)
- Доступ к административным действиям ограничен по ролям (User, Admin), проверка происходит как на клиенте, так и на сервере

## Структура проекта (по папкам)

    /actions
     -  в этой папке находятся функции, отвечающие за взаимодействие с API, в основном с использованием fetch() Next.js
        это  GET-запрос, который выполняется на сервере и является динамическим. Используются в серверных компонентах в файлах page.tsx, большая часть запросов выполняется в главном файле page.tsx

    /app
     -  папка  содержит всю маршрутизацию проекта, включая страницы сайта и серверные маршруты (API Routes)

    /components
     - папка  содержит все UI-компоненты, которые используются на различных страницах проекта. Компоненты разделены по смыслу и назначению, что упрощает поддержку и переиспользование. Компонент инкапсулирует в себе визуальную часть и, при необходимости, связанную с ним логику.Используются в страницах из папки /app для построения интерфейса

    /fonts
     - папка  содержит  шрифт Lato, используемый в проекте

    /hooks
     - папка содержит один кастомный хук, который помогает с адаптивом

    /lib
     - папка содержит файл с функцией подключения PrismsaClient и файл utils с кастомной ошибкой и clsx-утилита для className

    /prisma
     - папка содержит файлы с миграцией и файл схемы

    /provider
     - папка  содержит файл, который объединяет и экспортирует все глобальные провайдеры, необходимые для корректной работы приложения. Эти провайдеры оборачивают корневой компонент, предоставляя доступ к контекстам, настройкам и функционалу на всём протяжении приложения.
         Включённые провайдеры:
            - QueryClientProvider из библиотеки TanStack Query (React Query). Отвечает за кэширование, синхронизацию и управление состоянием данных, получаемых с сервера
            - SessionProvider из библиотеки NextAuth.js.Управляет сессией пользователя: хранение токенов, проверка авторизации, доступ к данным пользователя
            - Toast отвечает за отображение всплывающих уведомлений (toast-сообщений), таких как ошибки, успешные действия, предупреждения и т.д.
            - NextSSRPlugin из библиотеки @uploadthing/react.Необходим для корректной работы UploadThing в режиме серверного рендеринга (SSR) в Next.js

    /public
     - папка  в Next.js предназначена для хранения статических ресурсов, которые доступны напрямую по URL без дополнительной обработки сервером. В нашем сучае это изображения

    /react-queries
     - в папке находятся файлы, содержащие функции всех типов HTTP-запросов (GET, POST, PUT, DELETE), выполненные с использованием Axios и кастомные хуки, созданные на основе  React Query.
     Функции используются в кастомных хукаx для удобного и эффективного управления асинхронными запросами

    /server-action
     - папка содержит серверные функции, которые выполняются только на серверной стороне с помощью Server Actions в Next.js. Эти действия напрямую взаимодействуют с базой данных ( через Prisma) для обновления или удаления данных.

    /stores
     - папка содержит файлы с Zustand-хранилищами, предназначенными для управления локальным состоянием в клиентской части приложения. Используется для обеспечения реактивности и простого доступа к данным без необходимости пробрасывать пропсы.
      Состояния:
       - Корзина — добавление и удаление товаров, подсчёт итогов
       - Избранные товары — хранение списка любимых товаров пользователя
       - Меню на странице товара — управление выбором разделов
       - Поисковая строка — текущее имя товара
     useStore.ts — вспомогательная обёртка над zustand для устранения конфликтов с Server Components и Server-Side Rendering (SSR). Позволяет безопасно использовать Zustand в Next.js App Router

    /types
     - папка содержит файлы с типами для всех получаемых данных

    /utils
     - папка содержит файлы с функциями ,которые используются в различных компонентах

    /validators
     - папка содержит валидационные схемы, созданные с использованием библиотеки Zod, для проверки данных перед отправкой на сервер.

## Навигация и структура страниц

Интернет-магазин имеет чётко организованную и удобную навигацию, реализованную через страницы в папке app.

### Header (шапка сайта)

Верхняя часть:

- cсылки на статические страницы: About us, Delivery & Returns, Payment, Contacts
- аутентификация: Sign in / Sign up, Личный кабинет, Dachbord (для администратора), Log out

Средняя часть:

- cсылки на основные категории: Boys, Girls, Men, Women. При клике открывается каталог с подкатегориями одежды.
- поиск: поле ввода для быстрого поиска товаров
- корзина и избранные товары — иконки с переходом

Нижняя часть:

- ссылка на страницу Shop our latest sale styles — товары с большими скидками

### Главная страница (/)

Содержит визуально привлекательные и функциональные блоки:

- билборд (карусель) — 4 баннера с переходом на коллекции
- New Arrivals — карусель из 6 новых товаров + ссылка на страницу с новинками
- коллекции — 4 изображения, каждая ведёт на определённую коллекцию
- Popular Categories — 6 изображений с переходом на популярные категории
- Trending Now — карусель с товарами-лидерами продаж
- Sale up to 70% — карусель с акционными товарами + ссылка на общую страницу скидок
- Write to Us — блок с возможностью перейти на страницу отзывов о магазине

### Footer (подвал сайта)

Footer расположен в нижней части сайта и помогает пользователю быстро найти важную информацию или перейти к нужному разделу. Он разделён на три основных блока:

- HELP: About us — информация о компании, Delivery & returns — условия доставки и возврата, Payment — способы оплаты, Contacts — контактная информация
- SHOP: New arrivals — ссылка на страницу с новыми поступлениями, Sales — товары со скидками
- GET IN TOUCH Call: номер телефона, электронная почта

### Страницы категорий и подкатегорий имеют:

- Фильтрацию по атрибутам (цвет, размер и т.д.)
- Сортировку по цене, популярности
- Пагинацию
- Возможность открыть страницу конкретного товара по клику

### Прочие страницы

Страница товара — детальная страница с изображениями, описанием, кнопками добавления в корзину и избранное, отзывами о товаре,рейтингом, возможностью оставить отзыв и поставить оценку товару, возможность поддержать или не согласиться с отзывом другого пользователя: лайк/дизлайк

Order, Checout, страницы администратора, пользователя и другие страницы — каждая с уникальным функционалом, соответствующим задачам пользователя.

Навигация реализована на основе маршрутизации app router в Next.js 14, включая поддержку динамических маршрутов, параметров URL и динамической генерации страниц.

## Основной функционал

### Аутентификация и авторизация

В проекте используется NextAuth.js для организации аутентификации и авторизации пользователей

Кастомная формы регистрации и входа:

- Пользователи могут создавать аккаунт и входить в систему с использованием электронной почты и пароля

Вход через Google:

- Поддерживается OAuth-авторизация через Google-провайдер

Сессии:

- Аутентификация реализована через JWT (JSON Web Tokens) и SessionProvider

Роли пользователей:

- User: обычный пользователь, может оформлять заказы, оставлять отзывы, управлять личным кабинетом
- Admin: имеет доступ к административной панели, управлению товарами, пользователями и аналитике

Защищённые маршруты:

- Определённые страницы и действия доступны только для авторизованных пользователей или только для админов, в зависимости от их роли

### Фильтрация товаров

В приложении реализована гибкая система фильтрации товаров на страницах категорий. Фильтрация осуществляется с помощью параметров в URL и next/navigation

Основные особенности:

- Используется хук useSearchParams() из next/navigation для чтения параметров фильтра из URL
- Для изменения параметров используется new URLSearchParams() — добавление/удаление значений фильтра
- Выбранные фильтры отражаются в URL, что позволяет делиться ссылкой на отфильтрованную страницу
- Поддерживается множественный выбор (например, несколько брендов или цветов)
- При изменении фильтров происходит обновление списка товаров без перезагрузки страницы

Такой подход делает фильтрацию отзывчивой, удобной и легко расширяемой, а также улучшает SEO и пользовательский опыт.

### Сортировка товаров

Сортировка реализована по тем же принципам, что и фильтрация — через параметры в URL и работу с next/navigation

Основные возможности:

- Сортировка по цене (по возрастанию и убыванию)
- Сортировка по рейтингу (от лучших к худшим)
- Выбранный вариант сортировки отображается в URL через параметр sort
- При изменении параметра сортировки происходит обновление списка товаров без перезагрузки

Такой подход позволяет сохранять сортировку при навигации, делиться ссылками с конкретным порядком отображения товаров и улучшает UX.

### Поиск товаров

Поиск товаров реализован через поле ввода, расположенное в header. Пользователь может найти нужный товар по ключевым словам.

Поиск выполняется на стороне сервера и охватывает следующие характеристики товара:

- Тип (type)
- Бренд (brand)
- Материал (material)

По мере ввода запроса фильтруются товары, соответствующие хотя бы одному из этих параметров. Функция доступна как авторизованным, так и неавторизованным пользователям. Результаты поиска отображаются в виде списка товаров на странице search с возможностью перехода на детальную страницу.

### Пагинация

Пагинация реализована на тех же принципах, что и фильтрация и сортировка — через параметры в URL, а также с использованием библиотеки react-paginate.

Особенности:

- При переходе на другую страницу параметр page добавляется в URL
- Компонент пагинации рендерится с помощью react-paginate, что позволяет легко кастомизировать внешний вид и поведение
- URL сохраняет текущую страницу, сортировку и фильтрацию
- При переходе между страницами происходит обновление товаров без перезагрузки

Такой подход обеспечивает удобную навигацию, позволяет делиться ссылками на конкретные страницы и повышает удобство пользователя.

### Корзина и оформление заказа

Добавление в корзину:

- Добавлять товары в корзину могут как авторизованные, так и неавторизованные пользователи
- Для неавторизованных пользователей данные корзины хранятся в localStorage
- При авторизации пользователя все товары, которые были добавлены в корзину до входа в аккаунт, автоматически синхронизируются и сохраняются в базе данных
- Товар добавляется вместе с выбранными опциями: размер, цвет и количество

  #### Функционал корзины:

  Отображение всех добавленных товаров с возможностью:

- Изменить количество
- Удалить товар
- Автоматический расчёт общей стоимости заказа

  #### Оформление заказа:

  Оформить заказ может только авторизованный пользователь

  Пользователь указывает:

- Адрес доставки
- Метод доставки

  На этапе оформления заказа отображаются:

- Список всех товаров
- Подсчёт стоимости с учётом доставки

Оплата:

- Оплата заказа осуществляется через ЮKassa
- После успешной оплаты пользователь получает подтверждение

### Избранные товары

Добавление в избранные:

- Добавлять товары в избранное могут как авторизованные, так и неавторизованные пользователи
- Для неавторизованных пользователей данные об избранных товарах временно сохраняются в localStorage

При авторизации пользователя:

- Все товары, которые были добавлены в избранные до входа в аккаунт автоматически синхронизируются и сохраняются в базе данных

### Функционал личного аккаунта пользователя

Личный кабинет предоставляет пользователю возможность управлять своей учетной записью и активностью на сайте.
Он интуитивно понятен и предназначен для того, чтобы пользователи могли легко:

- Обновлять свои персональные данные
- Просматривать свои заказы
- Следить за своей активностью в отзывах ( просмотр, редактирование, удаление )
- Настраивать внешний вид профиля с помощью аватарки

### Панель администратора

Панель администратора предназначена для управления данными магазина и мониторинга продаж

Функциональность включает:

- Управление пользователями ( просмотр данных пользователя, удаление пользователей )
- Управление заказами ( просмотр списка заказов клиентов с деталями: состав заказа, стоимость, статус)
- Управление товарами( добавление новых товаров с изображениями и характеристиками, редактирование информации о товарах, удаление товаров)
- А также управление другими данными ( тип товара, брэнд, материал товара, цвет, размер, коллекции и т.д.)

Аналитика продаж:

- Отображение количества заказов по месяцам
- Вывод общей суммы продаж по каждому месяцу

Управление информационными страницами (About us, Delivery & Returns, Payment, Contacts):

- Редактирование содержимого через текстовый редактор Tiptap с поддержкой форматирования текста (заголовки, списки, изображения и т.д.)
- Сохранение изменений напрямую в базу данных для мгновенного отображения на соответствующих страницах сайта

## Загрузка изображений

- Загрузка изображений реализована с помощью UploadThing
- Пользователи и администраторы могут загружать изображения товаров, аватаров и коллекций
- Конфигурация включает ограничения по количеству и типу файлов, а также настройку прав доступа
- Загруженные файлы автоматически сохраняются и возвращаются в виде URL, которые затем используются в базе данных через Prisma

## Работа с ЮKassa

ЮKassa не работает на http://localhost:3000, поэтому нужно установить ngrok (это инструмент для создания безопасных туннелей между локальным сервером (на вашем компьютере) и интернетом. Он позволяет временно открыть доступ к локальному хосту (например, веб-серверу на localhost:3000) через публичный URL-адрес) или что-то подобное.

- Запустить ngrok
- Открыть проект на URL-ngrok (пример: https://126a-51-159-195-203.ngrok-free.app )
- В настройках ЮKassa (HTTP-уведомления) внести изменения в URL для уведомлений (пример:https://126a-51-159-195-203.ngrok-free.app/api/payment)

## Скриншоты:

1. Домашняя страница

![Домашняя страница](https://github.com/user-attachments/assets/f0f0bca0-201e-48b4-b10a-8ba8a3a82952)

2. Выбор типа одежды по категориям

![Image](https://github.com/user-attachments/assets/e45d4163-0f8d-4805-9779-800e8d33b75a)

3. Страница с выбранным типом одежды

![Image](https://github.com/user-attachments/assets/6a116aed-e111-47f1-97f3-d3d680d4ae81)

4. Страница с выбранной категорией New Arrivals

![Image](https://github.com/user-attachments/assets/8e8eb1c0-b2f4-4de2-a098-c1ac851322d4)

5. Поиск

![Image](https://github.com/user-attachments/assets/386aa1dd-9707-4499-861f-63045a560b39)

6. Страница товара

![Image](https://github.com/user-attachments/assets/c39716f0-124b-4cdf-8c43-629de316eb74)

7. Страница товара, вкладка отзывы

![Image](https://github.com/user-attachments/assets/87967ba5-dcd6-48d7-9fa1-9719fb5f49ec)

8. Страница товара, оформление отзыва

![Image](https://github.com/user-attachments/assets/b3dd18ed-0fd3-4060-8ef7-ce171704e52a)

9. Личный кабинет пользователя

![Image](https://github.com/user-attachments/assets/b43e96c7-7bb1-4f04-b35f-a606f3cde6ba)

10. Админ панель

![Image](https://github.com/user-attachments/assets/5f7003e9-8a45-4c5d-b13e-d358f5137004)

11. Админ панель(аналитика продаж)

![Image](https://github.com/user-attachments/assets/f5d6ad9d-154d-4b17-8b2c-034a67aa5c7e)

12. Админ панель(вкладка товары)

![Image](https://github.com/user-attachments/assets/84bd6926-fb2c-45c1-aeba-96da9c58dca1)

13. Админ панель(добавление товара)

![Image](https://github.com/user-attachments/assets/5d532433-3904-4bb4-aef2-259f33c14b61)

14. Админ панель(редактирование товара)

![Image](https://github.com/user-attachments/assets/4b4f2955-9d00-4324-b1e3-3f86b2b4a323)

15. Админ панель (редактирование страницы оплаты)

![Image](https://github.com/user-attachments/assets/890d0184-67c9-44f7-a5a6-0f987df2b169)

16. Страница отзывов о магазине(вход с админа)

![Image](https://github.com/user-attachments/assets/ccdf1acd-0ee0-437c-8c85-4147b0007aff)

17. Страница отзывов(добавление отзыва)

![Image](https://github.com/user-attachments/assets/fe10509d-c76d-495e-bb81-31622cffc28b)

18. Страница входа/регистрации

![Image](https://github.com/user-attachments/assets/7a9500d1-9604-4180-b19f-86b42cd57435)

19. Избранные товары

![Image](https://github.com/user-attachments/assets/786c3c7e-790c-4c32-931c-776c46e36707)

20. Корзина

![Image](https://github.com/user-attachments/assets/ee7a7320-fbf8-4f95-8f15-ee57158267fa)

21. Страница заказа

![Image](https://github.com/user-attachments/assets/c7b3040d-5fed-455b-b91f-3734e683d8ff)

22. Оплата через Юкасса

![Image](https://github.com/user-attachments/assets/1b21b997-d6ac-4c5a-96ee-6b173b366228)
![Image](https://github.com/user-attachments/assets/5507e7f9-b686-4744-add4-c2a68c7fd022)

23. Страница выполнения заказа

![Image](https://github.com/user-attachments/assets/c1217ebb-a3ab-4684-9633-a2c32fda66d1)
